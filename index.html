<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒã‚¤ãƒ³ã‚¹ã‚¤ãƒ¼ãƒ‘</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* ãƒ‡ã‚¸ã‚¿ãƒ«æ•°å­—ç”¨ã®ãƒ•ã‚©ãƒ³ãƒˆ */
        body {
            touch-action: manipulation; /* ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã«ã‚ˆã‚‹ã‚ºãƒ¼ãƒ ã‚’ç„¡åŠ¹åŒ– */
        }
        .digital-font {
            font-family: 'VT323', monospace;
        }
        /* ã‚²ãƒ¼ãƒ ã®è¦‹ãŸç›®ã‚’Windowsã‚¯ãƒ©ã‚·ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ«ã«è¿‘ã¥ã‘ã‚‹ */
        .game-container {
            border: 4px solid #f0f0f0;
            border-right-color: #808080;
            border-bottom-color: #808080;
            background-color: #c0c0c0;
        }
        .game-header {
            border: 4px solid #c0c0c0;
            border-right-color: #f0f0f0;
            border-bottom-color: #f0f0f0;
            margin: 8px;
        }
        .status-display {
            background-color: #000;
            color: #ff0000;
            padding: 2px 6px;
            font-size: 2.5rem; /* 40px */
            line-height: 1.2;
            letter-spacing: 2px;
        }
        .smiley-button {
            width: 44px;
            height: 44px;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 4px solid #f0f0f0;
            border-right-color: #808080;
            border-bottom-color: #808080;
            background-color: #c0c0c0;
        }
        .smiley-button:active {
            border-top-color: #808080;
            border-left-color: #808080;
            border-right-color: #f0f0f0;
            border-bottom-color: #f0f0f0;
        }
        .game-grid-container {
            border: 4px solid #808080;
            border-right-color: #f0f0f0;
            border-bottom-color: #f0f0f0;
            margin: 8px;
        }
        .cell {
            width: 30px;
            height: 30px;
            display: flex; /* Use flexbox for centering content within the cell */
            align-items: center;
            justify-content: center;
            font-size: 16px; /* ã‚»ãƒ«å†…ã®æ•°å­—ã‚„çµµæ–‡å­—ã®ã‚µã‚¤ã‚º */
            font-weight: bold;
            background-color: #c0c0c0;
            border: 3px solid #f0f0f0;
            border-right-color: #808080;
            border-bottom-color: #808080;
            user-select: none; /* ãƒ†ã‚­ã‚¹ãƒˆé¸æŠã‚’ç„¡åŠ¹åŒ– */
        }
        .cell.revealed {
            border: 1px solid #808080;
            background-color: #c0c0c0;
        }
        .cell.mine-hit {
            background-color: red;
        }
        /* æ•°å­—ã®è‰² */
        .cell[data-count="1"] { color: #0000ff; }
        .cell[data-count="2"] { color: #008000; }
        .cell[data-count="3"] { color: #ff0000; }
        .cell[data-count="4"] { color: #000080; }
        .cell[data-count="5"] { color: #800000; }
        .cell[data-count="6"] { color: #008080; }
        .cell[data-count="7"] { color: #000000; }
        .cell[data-count="8"] { color: #808080; }
    </style>
</head>
<body class="bg-teal-700 flex items-center justify-center min-h-screen p-4">

    <div id="game-container" class="game-container p-2 inline-block">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼šãƒã‚¤ãƒ³æ•°ã€ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã€ã‚¿ã‚¤ãƒãƒ¼ -->
        <div class="game-header p-2 flex justify-between items-center">
            <div id="mine-counter" class="status-display digital-font">010</div>
            <button id="reset-button" class="smiley-button">ğŸ™‚</button>
            <div id="timer" class="status-display digital-font">000</div>
        </div>

        <!-- ã‚²ãƒ¼ãƒ ç›¤ -->
        <div id="game-grid" class="game-grid-container">
            <!-- JavaScriptã§ã‚»ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ -->
        </div>

        <!-- é›£æ˜“åº¦è¨­å®š -->
        <div class="p-2 text-center">
            <select id="difficulty" class="bg-gray-200 border border-gray-400 rounded p-2">
                <option value="easy">åˆç´š (9x9, 10 Mines)</option>
                <option value="medium" selected>ä¸­ç´š (16x16, 40 Mines)</option>
                <option value="hard">ä¸Šç´š (30x16, 99 Mines)</option>
            </select>
        </div>
    </div>

    <script>
        // DOMè¦ç´ ã®å–å¾—
        const grid = document.getElementById('game-grid');
        const mineCounterEl = document.getElementById('mine-counter');
        const timerEl = document.getElementById('timer');
        const resetButton = document.getElementById('reset-button');
        const difficultySelect = document.getElementById('difficulty');

        // ã‚²ãƒ¼ãƒ è¨­å®š
        let settings = {
            easy: { rows: 9, cols: 9, mines: 10 },
            medium: { rows: 16, cols: 16, mines: 40 },
            hard: { rows: 16, cols: 30, mines: 99 }
        };

        let rows, cols, mineCount;
        let board = [];
        let mineLocations = [];
        let revealedCount = 0;
        let flagsPlaced = 0;
        let timerInterval;
        let time = 0;
        let gameOver = false;
        let firstClick = true;

        // --- åˆæœŸåŒ–å‡¦ç† ---
        function initGame() {
            // ç¾åœ¨ã®é›£æ˜“åº¦è¨­å®šã‚’å–å¾—
            const difficulty = difficultySelect.value;
            rows = settings[difficulty].rows;
            cols = settings[difficulty].cols;
            mineCount = settings[difficulty].mines;

            // çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            gameOver = false;
            firstClick = true;
            revealedCount = 0;
            flagsPlaced = 0;
            time = 0;
            board = [];
            mineLocations = [];
            
            // ã‚¿ã‚¤ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦åœæ­¢
            clearInterval(timerInterval);
            timerInterval = null;

            // è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
            updateMineCounter();
            timerEl.textContent = '000';
            resetButton.textContent = 'ğŸ™‚';
            
            // ã‚°ãƒªãƒƒãƒ‰ã‚’ã‚¯ãƒªã‚¢ã—ã¦å†ç”Ÿæˆ
            grid.innerHTML = '';
            // â˜…â˜…â˜… ä¿®æ­£ç‚¹: CSS Gridã‚’æœ‰åŠ¹ã«ã™ã‚‹ â˜…â˜…â˜…
            grid.style.display = 'grid'; 
            grid.style.gridTemplateColumns = `repeat(${cols}, auto)`;
            grid.style.width = 'auto'; // å¹…ã¯è‡ªå‹•èª¿æ•´ã«
            grid.style.height = 'auto'; // é«˜ã•ã‚‚è‡ªå‹•èª¿æ•´ã«


            for (let r = 0; r < rows; r++) {
                let row = [];
                for (let c = 0; c < cols; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.dataset.row = r;
                    cell.dataset.col = c;

                    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                    cell.addEventListener('click', handleCellClick);
                    cell.addEventListener('contextmenu', handleRightClick);
                    grid.appendChild(cell);
                    row.push({
                        element: cell,
                        isMine: false,
                        isRevealed: false,
                        isFlagged: false,
                        adjacentMines: 0
                    });
                }
                board.push(row);
            }
        }
        
        // --- ãƒœãƒ¼ãƒ‰ç”Ÿæˆ (æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯å¾Œ) ---
        function generateBoard(initialRow, initialCol) {
            // 1. åœ°é›·ã‚’é…ç½®
            let placedMines = 0;
            while (placedMines < mineCount) {
                const r = Math.floor(Math.random() * rows);
                const c = Math.floor(Math.random() * cols);

                // æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯ç®‡æ‰€ã¨ãã®å‘¨å›²ã«ã¯åœ°é›·ã‚’ç½®ã‹ãªã„
                const isInitialClickArea = Math.abs(r - initialRow) <= 1 && Math.abs(c - initialCol) <= 1;

                if (!board[r][c].isMine && !isInitialClickArea) {
                    board[r][c].isMine = true;
                    mineLocations.push([r, c]);
                    placedMines++;
                }
            }

            // 2. å„ã‚»ãƒ«ã®éš£æ¥ã™ã‚‹åœ°é›·ã®æ•°ã‚’è¨ˆç®—
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (board[r][c].isMine) continue;
                    let count = 0;
                    for (let dr = -1; dr <= 1; dr++) {
                        for (let dc = -1; dc <= 1; dc++) {
                            if (dr === 0 && dc === 0) continue;
                            const nr = r + dr;
                            const nc = c + dc;
                            if (nr >= 0 && nr < rows && nc >= 0 && nc < cols && board[nr][nc].isMine) {
                                count++;
                            }
                        }
                    }
                    board[r][c].adjacentMines = count;
                }
            }
        }

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ© ---
        function handleCellClick(event) {
            if (gameOver) return;

            const cellEl = event.currentTarget; // event.targetã‹ã‚‰å¤‰æ›´
            const row = parseInt(cellEl.dataset.row);
            const col = parseInt(cellEl.dataset.col);
            const cellData = board[row][col];

            if (cellData.isRevealed || cellData.isFlagged) {
                return;
            }

            // æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
            if (firstClick) {
                generateBoard(row, col);
                startTimer();
                firstClick = false;
            }

            // åœ°é›·ã‚’è¸ã‚“ã å ´åˆ
            if (cellData.isMine) {
                endGame(false); // å¼•æ•°ã¯ isWin
                cellData.element.classList.add('mine-hit');
                return;
            }

            revealCell(row, col);
            checkWinCondition();
        }

        function handleRightClick(event) {
            event.preventDefault(); // å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ç„¡åŠ¹åŒ–
            if (gameOver) return;

            const cellEl = event.currentTarget; // event.targetã‹ã‚‰å¤‰æ›´
            const row = parseInt(cellEl.dataset.row);
            const col = parseInt(cellEl.dataset.col);
            const cellData = board[row][col];
            
            if (cellData.isRevealed) return;

            // ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹/å¤–ã™
            cellData.isFlagged = !cellData.isFlagged;
            if (cellData.isFlagged) {
                cellData.element.textContent = 'ğŸš©';
                flagsPlaced++;
            } else {
                cellData.element.textContent = '';
                flagsPlaced--;
            }
            updateMineCounter();
        }

        // --- ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ ---
        function revealCell(r, c) {
            // ç¯„å›²å¤–ã¾ãŸã¯æ—¢ã«é–‹ã‹ã‚Œã¦ã„ã‚‹ã‚»ãƒ«ã¯å‡¦ç†ã—ãªã„
            if (r < 0 || r >= rows || c < 0 || c >= cols) return;
            const cellData = board[r][c];
            if (cellData.isRevealed || cellData.isFlagged) return;

            cellData.isRevealed = true;
            cellData.element.classList.add('revealed');
            revealedCount++;
            
            if (cellData.adjacentMines > 0) {
                cellData.element.textContent = cellData.adjacentMines;
                cellData.element.dataset.count = cellData.adjacentMines;
            } else {
                // éš£æ¥ã™ã‚‹åœ°é›·ãŒ0ã®å ´åˆã€å‘¨ã‚Šã®ã‚»ãƒ«ã‚‚å†å¸°çš„ã«é–‹ã (Flood Fill)
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        if (dr === 0 && dc === 0) continue;
                        revealCell(r + dr, c + dc);
                    }
                }
            }
        }

        function checkWinCondition() {
            // åœ°é›·ä»¥å¤–ã®ã‚»ãƒ«ãŒã™ã¹ã¦é–‹ã‹ã‚ŒãŸã‚‰å‹åˆ©
            if (revealedCount === rows * cols - mineCount) {
                endGame(true);
            }
        }

        function endGame(isWin) {
            gameOver = true;
            clearInterval(timerInterval);

            // å…¨ã¦ã®åœ°é›·ã‚’è¡¨ç¤º
            mineLocations.forEach(([r, c]) => {
                const cellData = board[r][c];
                if (!cellData.isRevealed) {
                     if (isWin) {
                       cellData.element.textContent = 'ğŸš©';
                     } else if(cellData.isMine) {
                       cellData.element.textContent = 'ğŸ’£';
                     }
                }
                 // æ——ã‚’ç«‹ã¦ãŸã‘ã©åœ°é›·ãŒãªã‹ã£ãŸå ´åˆ
                if (cellData.isFlagged && !cellData.isMine) {
                    cellData.element.textContent = 'âŒ';
                }
            });

            if (isWin) {
                resetButton.textContent = 'ğŸ˜';
                mineCounterEl.textContent = '000';
            } else {
                resetButton.textContent = 'ğŸ˜µ';
            }
        }


        // --- UIæ›´æ–° ---
        function updateMineCounter() {
            const remaining = mineCount - flagsPlaced;
            mineCounterEl.textContent = String(remaining).padStart(3, '0');
        }

        function startTimer() {
            if (timerInterval) return;
            timerInterval = setInterval(() => {
                time++;
                if (time < 1000) {
                   timerEl.textContent = String(time).padStart(3, '0');
                }
            }, 1000);
        }

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ---
        resetButton.addEventListener('click', initGame);
        difficultySelect.addEventListener('change', initGame);


        // --- ã‚²ãƒ¼ãƒ é–‹å§‹ ---
        window.onload = function() {
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ä¸­ç´šã«ã™ã‚‹
            difficultySelect.value = 'medium';
            initGame();
        };

        // å³ã‚¯ãƒªãƒƒã‚¯ã‚’é›¢ã—ãŸã¨ãã«ã‚‚é¡”ã‚’å…ƒã«æˆ»ã™ãŸã‚ã®å‡¦ç†
        document.addEventListener('mouseup', () => {
             if (!gameOver) {
                resetButton.textContent = 'ğŸ™‚';
            }
        });

        // ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«é¡”ã‚’å¤‰ãˆã‚‹
        grid.addEventListener('mousedown', (e) => {
            if (!gameOver && e.button === 0) { // å·¦ã‚¯ãƒªãƒƒã‚¯ã®ã¿
                resetButton.textContent = 'ğŸ˜®';
            }
        });
        grid.addEventListener('mouseup', () => {
            if (!gameOver) {
                resetButton.textContent = 'ğŸ™‚';
            }
        });

    </script>
</body>
</html>
